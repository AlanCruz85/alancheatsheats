

SOURCE FOR ALL THE INFORMATION BELLOW: https://tryhackme.com/room/windowsforensics1
                                       https://app.letsdefend.io/training/lesson_detail/introduction-to-windows-registry-forensics
_________________________________________________________________________________________________________________________________________________________________                             
For persistance / privilege escalation

FYI, you can find info about services here:
HKLM\SYSTEM\CurrentControlSet\services\

1 - Startup
In order to view the files added to the startup file, the indexes below must be checked.

C:\Users\[Username]\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup

C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp

2 - Registry Run Keys

The following run keys are created by default on Windows systems:

● HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run
● HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce
● HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run
● HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnce

  NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Run
  NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\RunOnce

The following Registry keys can control automatic startup of services during boot:


● HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunServices Once
● HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunServices Once
● HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunServices
● HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunServices
___________________________________________________________________________________________________________________________________________________________

The following Registry keys can be used to set startup folder items for persistence:


● HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\UserShellFolders
● HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\ShellFolders
● HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\ShellFolders
● HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\UserShellFolders



Using policy settings to specify startup programs creates corresponding values in either of two Registry keys:

● HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run
● HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run


Source: mitre.org 
        https://app.letsdefend.io/training/lesson_detail/registry-run-keys-startup-folder
_____________________________________________________________________________________________________________________________________________

EVIDENCE OF EXECUTION

Programs executed by the user:
NTUSER.DAT\Software\Microsoft\Windows\Currentversion\Explorer\UserAssist\{GUID}\Count

ShimCache:
SYSTEM\CurrentControlSet\Control\Session Manager\AppCompatCache

AmCache:
Amcache.hve\Root\File\{Volume GUID}\

BAM/DAM:
SYSTEM\CurrentControlSet\Services\bam\UserSettings\{SID}
SYSTEM\CurrentControlSet\Services\dam\UserSettings\{SID}
____________________________________________________________________________________________________________________________________

EXTERNAL/USB DEVICE FORENSICS

Device identification:
SYSTEM\CurrentControlSet\Enum\USBSTOR
SYSTEM\CurrentControlSet\Enum\USB

First/Last Times:
SYSTEM\CurrentControlSet\Enum\USBSTOR\Ven_Prod_Version\USBSerial#\Properties\{83da6326-97a6-4088-9453-a19231573b29}\####
Oo64=first connection
0066=last connection
0067=last removal

USB device Volume Name:
SOFTWARE\Microsoft\Windows Portable Devices\Device

____________________________________________________________________________________________________________________________________

FILE/FOLDER USAGE OR KNOWLEDGE

Recent Files:
NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs
HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs

Office Recent Files:
NTUSER.DAT\Software\Microsoft\Office\VERSION
NTUSER.DAT\Software\Microsoft\Office\VERSION\UserMRU\LiveID_####\FileMRU

Shared Files and Directories
HKEY_LOCAL_MACHINE\System\Controlset001\Services\LanmanServer\Shares

ShellBags:
USRCLASS.DAT\Local Settings\Software\Microsoft\Windows\Shell\Bags
USRCLASS.DAT\Local Settings\Software\Microsoft\Windows\Shell\BagMRU
NTUSER.DAT\Software\Microsoft\Windows\Shell\BagMRU
NTUSER.DAT\Software\Microsoft\Windows\Shell\Bags

Open/Save and LastVisited Dialog MRUs:
NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\OpenSavePIDlMRU
NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\LastVisitedPidlMRU

Windows Explorer Address/Search Bars:
NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\TypedPaths
NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\WordWheelQuery

________________________________________________________________________________________________________________________________

SYSTEM INFO AND ACCOUNTS

OS Version:
SOFTWARE\Microsoft\Windows NT\CurrentVersion

Current Control set:
HKLM\SYSTEM\CurrentControlSet
SYSTEM\Select\Current
SYSTEM\Select\LastKnownGood

Computer Name:
SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName

Time Zone Information:
SYSTEM\CurrentControlSet\Control\TimeZoneInformation

Network Interfaces and Past Networks:
SYSTEM\CurrentControlSet\Services\Tcpip\Parameters\Interfaces

Autostart Programs (Autoruns):
NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Run
NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\RunOnce
SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce
SOFTWARE\Microsoft\Windows\CurrentVersion\policies\Explorer\Run
SOFTWARE\Microsoft\Windows\CurrentVersion\Run

SAM hive and user information:
SAM\Domains\Account\User


